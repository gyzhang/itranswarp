# iTranswarp

### 如何修改代码，发布阿里云上的个人版本？

1. 使用云上版本中的 application.yml 配置文件，其中包括 https 端口 443，ssl 证书配置，数据库对应密码；
2. 检查 resource 下的证书文件 your_cert_file.pfx；
3. maven package 跳过测试，在打包过程中会编译 main.less 生成 main.css 文件;
4. 在服务器上执行 sh itranswarp.sh stop 命令，然后拷贝打包后的 itranswarp.jar 文件到服务器上；
5. 在服务器上执行 sh itranswarp.sh start 命令，启动应用提供服务；
6. 访问 xprogrammer.net，检查是否正常提供服务。

```yaml
server:
  port: ${SERVER_PORT:443}
  ssl:
    enabled: true
    key-store: classpath:your_cert_file.pfx
    key-store-password: your password here
```



Full-featured CMS including blog, wiki, discussion, etc. powered by SpringBoot.

[![Build Status](https://travis-ci.org/michaelliao/itranswarp.svg?branch=master)](https://travis-ci.org/michaelliao/itranswarp)

* based on SpringBoot 2.x
* OAuth2 integration (weibo, QQ, facebook, etc.)
* SEO support
* REST API
* customized CSS with UIkit2

### Environment

- JDK 11
- MySQL 5.7
- Redis 4/5
- Nginx

### Build

```
$ mvn -DskipTests=true clean package
```

Or check [build.sh](build.sh).

### Initialize database

DDL and test data are generated by [SchemaBuilder.java](src/main/java/com/itranswarp/SchemaBuilder.java).

Create schema:

```
$ mysql -u root -p < release/ddl.sql
```

NOTE: re-run this SQL file will remove all existing data.

Import test data:

```
$ mysql -u root -p it < release/init.sql
```

### Run

```
java -jar itranswarp.jar
```

### Configuration

All configurations are passed by environments:

```
$ PROFILES=production TIME_ZONE=Asia/Shanghai DOMAIN=example.com \
  DB_HOST=localhost DB_PASSWORD=changeit \
  REDIS_HOST=localhost \
  java -jar itranswarp.jar
```

Please check [application.yml](src/main/resources/application.yml) for environment variables.

### Deploy

iTranswarp is deployed by Ansible. Scripts is ready for Ubuntu Server 18.04 x64.

Deploy script:

```
$ ansible/deploy.py --profile <env>
```

The deploy script will do following:

- install open jdk 11 headless;
- install nginx;
- install supervisor;
- deploy jar;
- deploy static resources;
- generate nginx configuration;
- generate supervisor configuration;
- update symbol link;
- reload supervisor;
- reload nginx.

### Docker

Support [.env.example](docker/.env.example) use local ip for test. 
```
$ cd docker
$ cp .env.example
$ vim .env
$ docker-compose up -d
```
test:
https://www.local.itranswarp.com/

